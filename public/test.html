<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="/css/style.css" />
	<link href="//vjs.zencdn.net/c/video-js.css" rel="stylesheet">
<head>
<body>
	<input id="search" type="text" placeholder="search tag"/>
	<span><a class="filter" data-filter="promoted" href="javascript:void(0)">Editor's Pick</a>&nbsp;|</span>
	<span><a class="filter" data-filter="popular" href="javascript:void(0)">Popular</a>&nbsp;|</span>
	<span><a class="filter" data-filter="global" href="javascript:void(0)">All</a>&nbsp;|</span>
	<span><a id="autoplay"  onclick="toggleAutoPlay()" href="javascript:void(0)">autoplay</a></span>
	<div id="results"></div>
	<div id="content"></div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.3/underscore-min.js"></script>
  <script src="js/isotope-min.js"></script>
	<script src="//vjs.zencdn.net/c/video.js"></script>
<script id="box" type="text/template">
<%
var len = d.length;
for(var i=0;i<len;i++){
	var dd=d[i];
	var auto = (autoplay)? 'autoplay':'';
		
	%>
	<div class="iso-box" >
		<video id="<%= dd.postId %>" onclick="play_pause('<%= dd.postId %>')" loop <%= auto %> src="<%= dd.videoLowURL %>"></video>

		<div class="desc">
			<div>
				<img height="50" width="50" src="<%= dd.avatarUrl %>"/>
			</div>
			<div class='bubble' data-likes="<%= dd.likes.count %>"></div>
			<div><%= dd.username %></div>
			<div><%= dd.description %></div>
			<div><% dd.location %></div>
		</div>
	</div>
		<% } %>
	
</script>
<script type="text/javascript">
var autoplay = false;
var box_tmpl = $('#box').html();
function filterVine(page){
	$.get('?filter='+page,function(data){
		// todo:  count all tags and  make some filters from a template
		$('#content').html('');
		$('#results').text('Results: '+data.data.count);
		var newItems=$($.trim(_.template(box_tmpl,{d:data.data.records})));
		$('#content').append(newItems).isotope('appended',newItems,function(){
				$('#content').isotope('reLayout');
		})
	});
}
function searchVine(tag,relayout){
	$.get('/?q='+tag,function(data){
		// todo:  count all tags and  make some filters from a template
		$('#content').html('');
		$('#results').text('Results: '+data.data.count);
			var newItems=$($.trim(_.template(box_tmpl,{d:data.data.records})));
			$('#content').append(newItems).isotope('appended',newItems,function(){
				$('#content').isotope('reLayout');
		})
	});
}
var current_tags={};
function handle_stats(v){
	for(var i in v.tags){
		if(typeof current_tags[v.tags[i].tag] != 'undefined'){
			current_tags[v.tags[i].tag] += 1;
		}else{
			current_tags[v.tags[i].tag] =1;
		}
	}
}
function toggleAutoPlay(){
	autoplay=(autoplay)?0:1;
	$('#autoplay').css('color',(autoplay)?'green':'red');
}
$(document).ready(function(){
      $('#content').isotope({
        itemSelector : '.iso-box',
       	layoutMode:'fitRows'
      });
    
	filterVine('promoted');
	$('#search').on('keyup',function(e){
		if(e.keyCode==13){
			var query = $(this).val();
			if(query){
				
				searchVine(query);	
			}

		}
	});
	$('.click-to-play').on('click',function(e){
		console.log($(this));
	});
	$('.filter').on('click',function(e){
		var filter = $(this).attr('data-filter');
		filterVine(filter);
	})

});
function play_pause(id){
        
_V_(id).ready(function(){
                if(this.paused()){
                        this.play();
                }else{
                        this.pause();
                }
        });

}
</script>

<body>
<html>
